#name: AWS EC2 Deploy
#
#on:
#  push:
#    branches:
#      - cicd
#  pull_request:
#      types: [closed]
#      branches:
#        - develop
#
#jobs:
#  deploy:
#    name: Deploy
#    runs-on: ubuntu-latest
#    environment: production
#
#    steps:
#      - name: Checkout-source code
#        uses: actions/checkout@v3
#
#      - name: AWS setting
#        uses: aws-actions/configure-aws-credentials@v2
#        with:
#          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
#          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#          aws-region: ap-northeast-2
#
#      - name: Login to ECR
#        uses: aws-actions/amazon-ecr-login@v1
#
#      - name: Build Docker image
#        run: |
#            docker build -t starbucks-renewal .
#            docker tag starbucks-renewal:latest ${{ secrets.IAM_USERNAME }}:latest
#
#      - name: Delete latest image in ECR
#        uses: appleboy/ssh-action@v1
#        with:
#          host: ${{ secrets.EC2_HOST }}
#          username: ${{ secrets.EC2_USERNAME }}
#          key: ${{ secrets.EC2_PRIVATE_KEY }}
#          script: |
#            aws ecr batch-delete-image --repository-name ${{ secrets.IAM_USERNAME }} --image-ids imageTag=latest
#            echo ">>> ECR에서 최신 이미지 삭제 완료"
#
